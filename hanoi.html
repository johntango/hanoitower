<html>

<head>
  <link rel="stylesheet" href="./style.css" />
  <script src="Output.js"></script>
</head>

<body>
  <div class='game' id="game">
  </div>

  <script>
    window.onload = function () {
      const pegArray = ["A", "B", "C"];
      var pegs = [];
      const pegHist = [{
          "A": [3, 2, 1],
          "B": [],
          "C": []
        },
        {
          "A": [3, 2],
          "B": [],
          "C": [1]
        },
        {
          "A": [3],
          "B": [2],
          "C": [1]
        },
        {
          "A": [3],
          "B": [2, 1],
          "C": []
        },
        {
          "A": [],
          "B": [2, 1],
          "C": [3]
        },
        {
          "A": [1],
          "B": [2],
          "C": [3]
        },
        {
          "A": [1],
          "B": [],
          "C": [3, 2]
        },
        {
          "A": [],
          "B": [],
          "C": [3, 2, 1]
        }
      ];
      var diskArray = []; // this stores the shaddow DOM disks 
      const game = document.getElementById('game');

      function plotAll(pegArray, pegMap) {
        pegArray.map((peg, pegindex) => { // loop over all pegs
          let disks = pegMap[peg]; // the array of disks on pegMap.A say
          if (disks.length > 0) {
            disks.map((disk, index, ) => {
              pickDisk = diskArray.filter((item) => {
                return item.id == disk;
              })
              positionDisk(pickDisk[0].newdiv, disk, index,
                pegindex) // disk is the disk number where larger is wider disk
            })
          }
        })
      };

      function positionDisk(domDiv, diskNumber, indexOnPeg, pegindex) {
        let disk = domDiv; // get handle on Disk in DOM 
        // set its position 
        let pegCenter = 300 * pegindex + 100;
        let diskWidth = diskNumber * 40 + 20;
        let base = 400;
        let diskHeight = 20;

        disk.style.left = pegCenter - diskWidth / 2;
        disk.style.width = diskWidth;
        disk.style.top = 400 - diskHeight * indexOnPeg;
        console.log('Disk:' + diskNumber + ' at top: ' + disk.style.top);
        disk.style.height = diskHeight;
      }
      const sleep = (milliseconds) => {
        return new Promise((resolve) => setTimeout(resolve, milliseconds));
      };

      function diskFactory(id, indexOnPeg, pegNumber, type) {
        // this determines start positions 
        let newdiv = document.createElement("div");
        positionDisk(newdiv, id, indexOnPeg, pegNumber);

        newdiv.setAttribute('class', type); // these are the pegs
        newdiv.setAttribute('id', id)
        game.appendChild(newdiv);
        return {
          id,
          newdiv
        }
      }

      function pegFactory(id, indexOnPeg, pegNumber, type) {
        // this determines start positions 
        let newdiv = document.createElement("div");

        newdiv.setAttribute('class', 'peg'); // these are the pegs
        newdiv.setAttribute('id', id)
        let pegCenter = 300 * pegNumber + 60;
        let base = 400;
        let diskHeight = 200;

        newdiv.style.left = pegCenter;
        newdiv.style.width = 20;
        newdiv.style.top = 200;
        newdiv.style.height = 200;
        game.appendChild(newdiv);

      }

      function initializeDisks(pegMap) {

        let disks = pegMap[pegArray[0]]; // all disks start on peg 0
        diskArray = disks.map((diskid, indexOnPeg) => { // this is a kind of shadow DOM
          return diskFactory(diskid, indexOnPeg, 0, 'disk');
        });
        pegArray.map((item, pegId) => {
          pegFactory(pegId, 0, pegId, 'peg');
        })
      }

      function run() {
        var pegMap = pegHist[0];
        initializeDisks(pegMap);
        for (let i = 0; i < pegHist.length; i++) {
          // assume all disks start on A peg 
          pegMap = pegHist[i];
          plotAll(pegArray, pegMap);
        }
      };
      run();
    };
  </script>
</body>

</html>